# 20220901목

## setTimeout의 역할

브라우저에 두 번째 인수(시간)를 전달하면서 시간이 경과하면 콜백 함수를 호출해달라고 요청

- 그 이후는 브라우저의 역할
  - 시간 경과 체크도 브라우저의 역할
    - 시간이 만료되면 tick 이벤트가 발생하고 그 때 태스크 큐로 넘어간다.

## 자바스크립트는 멀티스레드

프론트엔드 입장에서 ES + web API = 자바스크립트

- 콜 스택이 싱글스레드
- 브라우저가 멀티스레드

## 비동기가 무엇인가

명시적으로 함수를 호출하지 않고 브라우저가 호출하는 것

### 비동기는 왜 쓰는가

블로킹을 해결하기 위해

- 블로킹은 콜스택이 싱글스레드라서 발생
  - 멀티스레드로 하면 너무 복잡해짐
  - 싱글스레드로 동시성까지 잡고싶었다
    → 비동기가 등장

## 클라이언트와 서버의 통신 과정

물리적으로 멀리 떨어져있는 서버와 클라이언트의 커뮤니케이션이 필요함.

클라이언트는 서버로부터 HMTL, CSS, JS, 이미지, 폰트, 동영상 등 여러 리소스를 받아야 함.

- 서버가 해당 리소스들을 다 가지고 있고 브라우저가 리소스들을 받아서 화면에 렌더링 함

### HTTP 통신 규약의 필요성

서버에 리소스를 요청할 때 중구난방으로 요청하면 안 됨

- 중구난방의 요청 방법을 다 아는 건 비효율적
- 딱 하나의 규약인 HTTP를 정해서 해당 방식으로 리소스를 주고 받음

### REST API의 필요성

HTTP 통신 규약대로 요청은 하지만 디테일한 컨벤션이 부족

- 원활한 커뮤니케이션을 위한 약속으로 REST API가 나옴

## 에러 처리의 중요성

에러는 무조건 발생한다.

### 에러는 언제 어디서 감지하는 것이 좋을까

발생원(에러가 발생하는 지점)

- 수 백개의 함수의 발생원마다 에러 처리를 고려하기 힘들다
- 에러 처리 방식이 바뀌면 수 백개의 함수에 에러 처리 방식을 다 바꿔야 한다

top level(전역 실행 컨텍스트)

- 에러는 호출자 방향으로 전파된다
- 가장 바깥에서 에러 처리를 하는게 유지보수가 간편하고 모든 에러를 잡을 수 있다.

---

# 42장 비동기 프로그래밍

자바스크립트 엔진은 단 하나의 실행 컨택스트 스택을 갖는다.

- 동시에 2개 이상의 함수를 실행할 수 없다.
  - 싱글 스레드
  - 현재 실행 중인 태스크가 종료할 때 까지 다음에 실행될 태스크가 대기하는 동기 처리 방식
    - 실행 순서가 보장된다는 장점
    - 앞선 태스크 종료까지 이후 태스크들이 블로킹되는 단점

## 비동기

비동기 처리를 수행하는 비동기 함수는 전통적으로 콜백 패턴을 사용

- 콜백 헬을 발생시킴
  - 가독성을 나쁘게 함
- 비동기 처리 중 발생한 에러의 예외 처리가 곤란
- 여러 개의 비동기 처리를 한 번에 처리하는 데도 한계

### 비동기로 처리되는 경우

- 타이머 함수 (setTimeout, setInterval)
- HTTP 요청
- 이벤트 핸들러

## 콜스택과 힙

콜스택은 소스코드 평가 과정에서 생성된 실행 컨텍스트가 추가되고 제거되는 스택 자료구조

힙은 객체가 저장되는 메모리 공간

- 콜 스택의 요소인 실행 컨텍스트는 힙에 저장된 객체를 참조
- 객체는 원시 값과 달리 크기가 정해져 있지 않아 할당해야 할 메모리 공간의 크기를 런타임에 결정
  - 따라서 힙은 구조화되어 있지 않음

## JS 엔진과 브라우저의 역할

자바스크립트 엔진

- 소스코드 평가와 실행

브라우저 또는 Node.js

- 호출 스케줄링을 위한 타이머 설정
- 콜백 함수의 등록 (브라우저의 web API의 역할)
  - 콜백 함수를 태스크 큐에 푸시

## 이벤트 루프

콜 스택이 비었는지, 태스크 큐에 대기 중인 함수가 있는지 반복해서 확인하고 콜 스택이 비면 태스크 큐에 대기중인 함수를 콜 스택으로 푸시

- 브라우저에 내장
- 동시성(concurrency)를 지원
  - 동시에 실행되는 것 ‘처럼’ 보이는 것
  - 빠르게 전환하며 여러 작업을 수행
    - 결국 JS는 싱글 스레드이므로

### web API와 이벤트 루프의 역할

- web API : 콜백 함수를 태스크 큐에 푸시
- 이벤트 루프 : 태스크 큐의 콜백 함수를 콜 스택에 푸시

## 태스크 큐

비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역
